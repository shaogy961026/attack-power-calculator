<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>攻擊力計算機</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f9f9f9;
            color: #333;
        }
        h1 {
            color: #2c3e50;
            font-size: 2em;
            margin-bottom: 10px;
        }
        h2 {
            color: #2980b9;
            font-size: 1.5em;
            margin-top: 20px;
            margin-bottom: 10px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
        }
        input {
            padding: 10px;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        button {
            margin: 10px 0;
            padding: 10px 15px;
            background-color: #3498db;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #2980b9;
        }
        .percentages {
            width: 100%;
            height: 300px;
            overflow-y: auto;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .percentages-table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 10px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
            position: sticky;
            top: 0;
            z-index: 1;
        }
        .interpolated {
            background-color: #fff8b3; /* 黃色背景 */
            position: relative;
        }
        .interpolated:hover::after {
            content: '此值為插值法估算';
            position: absolute;
            top: -30px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 5px;
            border-radius: 4px;
            font-size: 0.8em;
            white-space: nowrap;
        }
        .version {
            margin-top: 20px;
            font-size: 0.9em;
            color: #666;
        }
        #result {
            margin-top: 15px;
            font-weight: bold;
            color: #333; /* 恢复默认颜色 */
        }
        #result-title {
            font-size: 1.2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        #result-text {
            color: #333; /* 加深颜色 */
        }
        .highlight {
            font-weight: bold;
            color: #e74c3c; /* 高亮等级 */
        }
    </style>
</head>
<body>

    <h1>攻擊力計算機</h1>

    <label for="physical">物理攻擊力:</label>
    <input type="number" id="physical" placeholder="輸入物理攻擊力">

    <label for="magic">魔法攻擊力:</label>
    <input type="number" id="magic" placeholder="輸入魔法攻擊力">

    <label for="points">總點數:</label>
    <input type="number" id="points" placeholder="輸入總點數">

    <button onclick="calculateTotal()">計算</button>
    <button onclick="clearInputs()">清除輸入</button>

    <h2>結果</h2>
    <div id="result-container">
        <div id="result-title">計算結果:</div>
        <p id="result-text">請輸入數值並點擊計算。</p>
    </div>

    <h2>等級與加乘百分比(估計值)</h2>
    <div class="percentages">
        <table class="percentages-table">
            <thead>
                <tr><th>等級</th><th>百分比</th></tr>
            </thead>
            <tbody id="percentages-body"></tbody>
        </table>
    </div>

    <div class="version">v1.1.2</div>

    <script>
        // 等級與百分比的資料方便維護
	const levelPercentageData = {
    	    1: 0.035,
	    2: 0.0661,
	    3: 0.0941,
	    4: 0.1196,
	    5: 0.1429,
	    6: 0.1644,
	    10: 0.2371,
	    20: 0.3636,
	    30: 0.4504,
	    40: 0.5166,
	    50: 0.5701,
	    52: 0.5797,
	    55: 0.5935,
	    59: 0.6108,
	    60: 0.6150,
	    70: 0.6537,
	    80: 0.6877,
	    86: 0.7063,
	    87: 0.7092,
	    90: 0.7180,
	    100: 0.7453,
	    110: 0.7702,
	    120: 0.7931,
	    130: 0.8142,
	    140: 0.8339,
	    150: 0.8523,
	    160: 0.8695,
	    170: 0.8857,
	    180: 0.9011,
	    190: 0.9156,
	    200: 0.9295,
	    210: 0.9426,
	    220: 0.9552,
 	    230: 0.9673,
 	    240: 0.9788,
 	    245: 0.9844,
	    250: 0.9899,
	    255: 0.9953,
	    260: 1.0006,
	    261: 1.0016,
	    262: 1.0027,
	    263: 1.0037,
	    264: 1.0047,
	    265: 1.0058,
	    266: 1.0068
	};

        const levels = Object.keys(levelPercentageData).map(Number);
        const percentages = Object.values(levelPercentageData);

        // 三次樣條插值的簡單近似
        function interpolate(x, xArray, yArray) {
	    if (x === 0) return 0; // 當等級為0時返回0%
            if (x <= xArray[0]) return yArray[0];
            if (x >= xArray[xArray.length - 1]) {
                const x0 = xArray[xArray.length - 2], x1 = xArray[xArray.length - 1];
                const y0 = yArray[yArray.length - 2], y1 = yArray[yArray.length - 1];
                return y1 + (y1 - y0) * (x - x1) / (x1 - x0);
            }

            let i = 1;
            while (xArray[i] < x) i++;

            const x0 = xArray[i - 1], x1 = xArray[i];
            const y0 = yArray[i - 1], y1 = yArray[i];

            return y0 + (y1 - y0) * (x - x0) / (x1 - x0);
        }

        function calculateTotal() {
            const magicPower = parseFloat(document.getElementById('magic').value);
            const physicalPower = parseFloat(document.getElementById('physical').value);
            const points = parseInt(document.getElementById('points').value);

            if (isNaN(magicPower) || isNaN(physicalPower) || isNaN(points)) {
                alert('請確保所有輸入都是有效的數字');
                return;
            }

            let max_value = 0;
            let best_distribution = { magic: 0, physical: 0 };

            for (let magicLevel = 0; magicLevel <= points; magicLevel++) {
                const physicalLevel = points - magicLevel;

                const magicIncrease = magicPower * (1 + interpolate(magicLevel, levels, percentages));
                const physicalIncrease = physicalPower * (1 + interpolate(physicalLevel, levels, percentages));

                const totalValue = magicIncrease + physicalIncrease;

                if (totalValue > max_value) {
                    max_value = totalValue;
                    best_distribution = { magic: magicLevel, physical: physicalLevel };
                }
            }

            const magicPercentage = interpolate(best_distribution.magic, levels, percentages);
            const physicalPercentage = interpolate(best_distribution.physical, levels, percentages);

            document.getElementById('result-text').innerHTML = `
                最大總值為 (估計值) : ${max_value.toFixed(2)}<br>
                最佳點數分配:<br>
		<span class="highlight">物理攻擊力 LV: ${best_distribution.physical} (使用百分比: ${(physicalPercentage * 100).toFixed(2)}%)</span><br>
                <span class="highlight">魔法攻擊力 LV: ${best_distribution.magic} (使用百分比: ${(magicPercentage * 100).toFixed(2)}%)</span>
            `;
        }

        function clearInputs() {
            document.getElementById('magic').value = '';
            document.getElementById('physical').value = '';
            document.getElementById('points').value = '';
            document.getElementById('result-text').innerHTML = '請輸入數值並點擊計算。';
        }

        function showPercentages() {
            const tbody = document.getElementById('percentages-body');
            tbody.innerHTML = ''; // 清空表格

            for (let lv = 1; lv <= 1000; lv++) {
                const row = document.createElement('tr');
                const levelCell = document.createElement('td');
                const percentageCell = document.createElement('td');

                levelCell.textContent = `LV${lv}`;

                let percentage;
                if (levelPercentageData[lv] !== undefined) {
                    percentage = levelPercentageData[lv];
                    percentageCell.textContent = `${(percentage * 100).toFixed(2)}%`;
                } else {
                    percentage = interpolate(lv, levels, percentages);
                    percentageCell.textContent = `${(percentage * 100).toFixed(2)}%`;
                    percentageCell.classList.add('interpolated'); // 標記為插值法計算
                }

                row.appendChild(levelCell);
                row.appendChild(percentageCell);
                tbody.appendChild(row);
            }
        }

        // 初始顯示等級百分比表格
        showPercentages();
    </script>

</body>
</html>