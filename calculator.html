<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack Power Calculator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
        }
        input {
            padding: 5px;
            width: 100%;
            box-sizing: border-box;
        }
        button {
            margin: 10px 0;
            padding: 10px 15px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #ccc;
            padding: 5px;
            text-align: center;
        }
        th {
            background-color: #f2f2f2;
        }
        .percentages {
            width: 100%;
            height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
    </style>
</head>
<body>

    <h1>攻擊力計算機</h1>

    <label for="magic">魔法攻擊力:</label>
    <input type="number" id="magic" placeholder="輸入魔法攻擊力">

    <label for="physical">物理攻擊力:</label>
    <input type="number" id="physical" placeholder="輸入物理攻擊力">

    <label for="points">總點數:</label>
    <input type="number" id="points" placeholder="輸入總點數">

    <button onclick="calculateTotal()">計算</button>

    <h2>結果</h2>
    <p id="result"></p>

    <h2>等級與加乘百分比(估計值)</h2>
    <div class="percentages" id="percentages"></div>

    <script>
        // 已知的等級與百分比
        const levels = [1, 2, 3, 4, 5, 10, 20, 30, 50, 100, 150, 200, 225];
        const percentages = [0.035, 0.0661, 0.0941, 0.1196, 0.1429, 0.2371, 0.3636, 
                            0.4504, 0.5701, 0.7453, 0.8523, 0.9295, 0.9613];

        // 三次樣條插值的簡單近似
        function interpolate(x, xArray, yArray) {
            if (x <= xArray[0]) return yArray[0];
            if (x >= xArray[xArray.length - 1]) {
                // 使用最後兩個已知點進行線性外推
                const x0 = xArray[xArray.length - 2], x1 = xArray[xArray.length - 1];
                const y0 = yArray[yArray.length - 2], y1 = yArray[yArray.length - 1];
                return y1 + (y1 - y0) * (x - x1) / (x1 - x0);
            }

            let i = 1;
            while (xArray[i] < x) i++;

            const x0 = xArray[i - 1], x1 = xArray[i];
            const y0 = yArray[i - 1], y1 = yArray[i];

            return y0 + (y1 - y0) * (x - x0) / (x1 - x0);
        }

        function calculateTotal() {
            const magicPower = parseFloat(document.getElementById('magic').value);
            const physicalPower = parseFloat(document.getElementById('physical').value);
            const points = parseInt(document.getElementById('points').value);

            if (isNaN(magicPower) || isNaN(physicalPower) || isNaN(points)) {
                alert('請確保所有輸入都是有效的數字');
                return;
            }

            let max_value = 0;
            let best_distribution = { magic: 0, physical: 0 };

            for (let magicLevel = 0; magicLevel <= points; magicLevel++) {
                const physicalLevel = points - magicLevel;

                // 使用插值函數計算等級增益
                const magicIncrease = magicPower * (1 + interpolate(magicLevel, levels, percentages));
                const physicalIncrease = physicalPower * (1 + interpolate(physicalLevel, levels, percentages));

                const totalValue = magicIncrease + physicalIncrease;

                if (totalValue > max_value) {
                    max_value = totalValue;
                    best_distribution = { magic: magicLevel, physical: physicalLevel };
                }
            }

            const magicPercentage = interpolate(best_distribution.magic, levels, percentages);
            const physicalPercentage = interpolate(best_distribution.physical, levels, percentages);

            document.getElementById('result').innerHTML = `
                最大總值為 (估計值) : ${max_value.toFixed(2)}<br>
                最佳點數分配:<br>
                魔法攻擊力 LV: ${best_distribution.magic} (使用百分比: ${(magicPercentage * 100).toFixed(2)}%)<br>
                物理攻擊力 LV: ${best_distribution.physical} (使用百分比: ${(physicalPercentage * 100).toFixed(2)}%)
            `;
        }

        // 顯示預測百分比
        function showPercentages() {
            const percentagesDiv = document.getElementById('percentages');
            percentagesDiv.innerHTML = ''; // 清空現有內容
            let table = '<table><tr><th>等級</th><th>百分比</th></tr>'; // 建立表格

            for (let level = 1; level <= 1000; level++) {
                const percentage = interpolate(level, levels, percentages);
                table += `<tr><td>LV${level}</td><td>${(percentage * 100).toFixed(2)}%</td></tr>`;
                // 每10級增加一行
                if (level % 10 === 0) {
                    table += '<tr><td colspan="2"></td></tr>'; // 每10級加一行空行
                }
            }
            table += '</table>';
            percentagesDiv.innerHTML = table; // 顯示表格
        }

        // 初始化時顯示預測百分比
        showPercentages();
    </script>

</body>
</html>
